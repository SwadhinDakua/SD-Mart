name: Deploy to AWS S3

on:
  push:
    branches:
      - main  # deploy every time main branch is updated

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          # These three lines must align perfectly
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ secrets.AWS_REGION }} # Ensure this uses 2 spaces before 'aws'

      - name: 3. Deploy files to S3 (Sync)
        uses: aws-actions/aws-cli@v1 
        with:
          args: |
            # CRITICAL: Use the secret for the bucket name
            s3 sync . s3://${{ secrets.S3_BUCKET_NAME }} \
            --delete \
            --acl public-read \
            --exclude '.git/*' \
            --exclude '.github/*'

      - name: 4. Deployment Success Message
        run: echo "SD Mart website deployed! Check your S3 Static Website Endpoint."
